/*!
 impleCode Product AJAX Scripts
 Manages product ajax related scripts
 (c) 2021 impleCode - https://implecode.com
 */
var ic_popstate=false;var ic_product_list="";var ic_filters_bar="";jQuery(document).ready(function(){ic_product_list=jQuery(".product-list").first();ic_filters_bar=jQuery(".product-sort-bar").first();if(jQuery(".product-list").length!==1&&ic_filters_bar.length===0){return true}var t=jQuery.ic.applyFilters("ic_ajax_submit_elements","form.ic_ajax, form.product_order, .product-sort-bar form#product_search_form, form.price-filter-form");jQuery("body").on("change",".product-search-box",function(){var t=jQuery(this).val();jQuery(".ic-search-keyword").text(t);jQuery(".product-search-box").val(t)});jQuery("body").on("submit",t,function(t){var e=jQuery(this);var i=e.closest(".product-sort-bar");if(i.length){ic_filters_bar=i;ic_product_list=i.nextAll(".product-list").first()}if(!ic_ajax_product_list_on_screen()){return true}t.preventDefault();var r="";r=jQuery("[name!=page]",this);var a=e.serialize();var c="";if(e.data("ic_ajax")==="page"){c=c+"page/"+e.find("[name=page]").val()}var s=r.serialize();if(s){c=c+"?"+s}var o=e.attr("action");if(c!==""){if(o.slice(-1)!=="/"&&e.data("ic_ajax")==="page"){o=o+"/"}c=o+c}else{c=o}var l="";if(e.hasClass("product_order")){l="product_order"}ic_ajax_update_product_listing(a,c,l)});var e="a.filter-url, .product-archive-nav li:not(.active) a, a.price-filter-link, a.ic-remove-active-filter";jQuery("body").on("click",e,function(t){var e=jQuery(this);var i=e.closest(".product-sort-bar");let r=e.closest(".product-archive-nav");if(i.length>0){ic_filters_bar=i;ic_product_list=i.nextAll(".product-list").first()}else if(r.length>0){let t=r.prev(".product-list");if(t.length>0){ic_product_list=t.first()}}if(!ic_ajax_product_list_on_screen()){return true}t.preventDefault();var a=e.attr("href");var c="";if(a.indexOf("?")!==-1){c=a.substr(a.indexOf("?")+1)}var s=false;var o="";if(e.closest("li").data("page")!==undefined){o=e.closest("li").data("page")}else if(e.data("page")!==undefined){o=e.data("page")}if(o!==""){if(c!==""){c=c+"&page="+o}else{c=c+"page="+o}s=e.attr("href")}var l=false;if(r.length>0){l=true}ic_ajax_update_product_listing(c,s,"",l)});if(jQuery(t).length||jQuery(e).length){ic_ajax_back_button_filters()}});function ic_ajax_update_product_listing(t,a,i,s){i=typeof i!=="undefined"?i:"";s=typeof s!=="undefined"?s:"";a=ic_defaultFor(a,false);if(a===false){a="?"+t}if(a!=="none"){window.history.pushState({form_data:t},document.title,a);ic_popstate=true}if(ic_product_list===""){ic_product_list=jQuery(".product-list").first()}if(ic_filters_bar===""){ic_filters_bar=jQuery(".product-sort-bar").first()}var e=ic_ajax.query_vars;var r=0;if(ic_product_list.data("ic_ajax_query")){e=JSON.stringify(ic_product_list.data("ic_ajax_query"));r=1}var o={action:"ic_self_submit",self_submit_data:t,query_vars:e,request_url:ic_ajax.request_url,ajax_elements:{},ic_shortcode:r,is_search:ic_ajax.is_search,security:ic_ajax.nonce};jQuery.ic.doAction("ic_self_submit_before");var c=jQuery(".ic_ajax").not(".product-sort-bar .ic_ajax");if(ic_filters_bar.length&&i===""){o["ajax_elements"]["product-sort-bar"]=1;c.add(ic_filters_bar.find(".ic_ajax"))}if(c.length){c.each(function(){if(jQuery(this).data("ic_ajax").length){var t=jQuery(this).data("ic_ajax");if(i===""||i===t){var e=jQuery(this).data("ic_ajax_data");if(!e){e=1}if(o["ajax_elements"][t]===undefined){if(o["ajax_elements"]["product-sort-bar"]===undefined){o["ajax_elements"][t]=e}else if(!jQuery(this).closest(".product-sort-bar").length){o["ajax_elements"][t]=e}}}}})}ic_product_list.css("opacity","0.5");jQuery.post(product_object.ajaxurl,o).done(function(c){jQuery(".reset-filters").remove();try{c=JSON.parse(c)}catch(t){location.reload();return false}if(!c){location.reload();return false}if(c["redirect"]){var t=new URL(c["redirect"]);if(t.host===window.location.host){window.location.replace(c["redirect"])}else{location.reload()}return false}var r=jQuery(c["product-listing"]).not("form, div.product-sort-bar, .reset-filters");ic_product_list.animate({opacity:0},"fast",function(){r=r.hide();jQuery(".product-list").removeClass("active-product-listing");r.addClass("active-product-listing");ic_product_list.replaceWith(r);ic_product_list=jQuery(".product-list.active-product-listing");ic_product_list.fadeIn("fast");setTimeout(modern_grid_font_size(),0);if(s&&!is_element_visible(ic_product_list.find("div:first-child"))){if(ic_product_list.find("div").length){jQuery("html, body").animate({scrollTop:ic_product_list.find("div").offset().top-100},"slow")}}if(jQuery(".product-archive-nav").length){jQuery(".product-archive-nav").replaceWith(c["product-pagination"])}else if(jQuery("div#product_sidebar").length){jQuery(c["product-pagination"]).insertAfter("div#product_sidebar")}else if(jQuery("article#product_listing").length){jQuery(c["product-pagination"]).insertAfter("article#product_listing")}else{ic_product_list.after(c["product-pagination"])}jQuery.each(o["ajax_elements"],function(t,e){var i=jQuery();if(t!=="product-sort-bar"){i=jQuery(":not(.product-sort-bar ) ."+t)}if(ic_filters_bar.length){if(t==="product-sort-bar"){i=ic_filters_bar}else{i.add(ic_filters_bar.find("."+t))}}if(i.length&&c[t]!==undefined){var r=jQuery(c[t]);var a=false;if(r.hasClass("ic-empty-filter")){a=true}if(!r.hasClass(t)){r=r.find("."+t)}if(r.length){i.replaceWith(r)}else{i.html("");a=true}if(a){i.closest(".widget").addClass("ic-empty-filter");r.closest(".widget").addClass("ic-empty-filter")}else{i.closest(".widget").removeClass("ic-empty-filter");r.closest(".widget").removeClass("ic-empty-filter")}i.trigger("reload");if(t==="product-sort-bar"){ic_filters_bar=jQuery(".product-sort-bar").first()}}});if(c["remove_pagination"]){var t=ic_ajax.request_url;if(t.indexOf("?")!==-1){t=t.substr(0,t.indexOf("?"))}var e="";if(a.indexOf("?")!==-1){e=a.substr(a.indexOf("?")+1)}if(e!==""){e="?"+e}var i=t+e;window.history.replaceState({},document.title,i)}jQuery.ic.doAction("ic_self_submit")})}).fail(function(){location.reload()})}function ic_ajax_back_button_filters(){jQuery(window).off("popstate",ic_ajax_run_filters);jQuery(window).on("popstate",ic_ajax_run_filters)}function ic_ajax_run_filters(t){var e=t.originalEvent.state;if(e!==null){if(e.form_data!==undefined){var i=e.form_data;if(i.length){ic_ajax_update_product_listing(i,"none")}else{window.location.reload()}}}else if(ic_popstate){location.reload()}}function ic_ajax_product_list_on_screen(){if(ic_product_list===""){ic_product_list=jQuery(".product-list").first()}if(ic_product_list.length===0){return false}if(ic_product_list.offset().top===0&&ic_product_list.offset().left===0){return false}if(jQuery(window).scrollTop()+jQuery(window).height()>ic_product_list.offset().top){return true}return false}